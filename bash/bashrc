# vim: set filetype=sh :
# My bashrc for non-login shells
# see /usr/share/doc/bash/examples/startup-files for examples
# Copyright Â© 2015 liloman
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, see <http://www.gnu.org/licenses/>.
#

# If not running interactively, don't do anything
[ -z "$PS1" ] && return

###################
#  Shell options  #
###################
#Set vi Mode 
set -o vi

# check the window size after each command and, if necessary,
# update the values of LINES and COLUMNS.
shopt -s checkwinsize

# Fix cd spelling
shopt -s cdspell

# Save multiline commands in one line
shopt -s cmdhist

# Dont delete history
shopt -s histappend

# Regexp in bash prompt
shopt -s extglob

# Dont need to hash -r when modify directories
# shopt -s checkhash

#Disable <C-s>(stop) and <C-q>(start) on terminal. To use <C-s> on vim (to save a file)
stty stop undef
stty start undef
#Disable control flow completely and press any key to start
stty -ixon -ixoff ixany

#Disable bloq mayuscula
# setxkbmap -option ctrl:nocaps
#xmodmap -e 'clear Lock' -e 'keycode 0x42 = Escape'


#######################
#  INTERNAL VARIABLES #
#######################

PROMPT_COMMAND=exitbash
PS1='$(dirsbash)\n\[\e[01;34m\][\[\e[00m\]\[\e[01;32m\]\u$(__git_ps1 "(%s)")->\[\e[00m\]\[\e[01;34m\]\w]\n[H:\#]>\[\e[00m\] ' 

#Default editor
EDITOR=vim  
HISTSIZE=50000
HISTFILESIZE=50000
#Maybe I should to rework this dinamic again...
HISTFILE=~/.bash_historys/history_

########################
#  EXPORTED VARIABLES  #
########################

# don't put duplicate lines in the history.
export HISTCONTROL=ignoredups
#Default vagrant provider to virtualbox otherwise libvirt
export VAGRANT_DEFAULT_PROVIDER=virtualbox

#less options applied
export LESS="-eIrMX" 
#-e quit at 2 eof, -I case insensitive search
#-r raw control displayed (colors), -M long prompt
# -X dont send de/initialization strings to the terminal
# make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] && eval "$(lesspipe)"

###########
#  Binds  #
###########

# Kind of work for history autocompletition (needs work)
bind -m vi-insert "\C-p":dynamic-complete-history
bind -m vi-insert "\C-n":menu-complete

# ctrl l make clear the screen on vi mode
bind -m vi-insert "\C-l":clear-screen

#Para que autocomplete tambien !$,!*,!!,!cat ... despues de un space ... :)
bind Space:magic-space

###########
#  Files  #
###########

# Add my scripts
if [ -d ~/Scripts ] ; then
    PATH=~/Scripts:$PATH
fi

#Z script to get the most common directories and so on
#git clone https://github.com/rupa/z 
if [ -f ~/Scripts/z/z.sh ]; then
    . ~/Scripts/z/z.sh
    _Z_DATA=$HOME/.zs/.z
fi

# Alias definitions
if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

# Function definitions
if [ -f ~/.bash_functions ]; then
    . ~/.bash_functions
fi

#Enable Autocompletions 
[ -f /usr/share/bash-completion/bash_completion ] && 
            . /usr/share/bash-completion/bash_completion

#To work with git
source ~/dotfiles/bash/git-completion.bash
source ~/dotfiles/bash/git-prompt.sh


